<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" >
    <title>TTRPG Item Creation Kit</title>
    <link href="Style.css" rel="stylesheet" >
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat&display=swap" rel="stylesheet">
</head>

<body>

    <main class="">

      <div id="authForm">
        <h2>Sign In</h2>
        <input type="text" placeholder="pseudo" id="userPseudo">
        <input type="email" placeholder="email" id="userEmail">
        <input type="password" placeholder="password" id="userPassword"> <br><br>
        <button id="signUpButton">Account Creation</button>
        <button id="signInButton">Connect</button>

      </div>

       <div>
        
        <div id="creationKitForm">
          <div id="creationCommon">
            <select name="objectTypeList" id="objectTypeList">
              <option value="DefaultObjectTypeList">Please select an item type</option>
              <option value="Weapon">Weapon</option>
              <option value="Armor">Armor</option>
              <option value="Potion">Potion</option>
              <option value="Scroll">Scroll</option>
              <option value="Material">Material</option>
              <option value="Food">Food</option>
            </select>
            <div id="creationName">
              <select name="objectRarityList" id="objectRarityList">
                <option value="Common">Common</option>
                <option value="Rare">Rare</option>
                <option value="Unique">Unique</option>
                <option value="Epic">Epic</option>
                <option value="Legendary">Legendary</option>
                <option value="Divine">Divine</option>
                <option value="Primordial">Primordial</option>
              </select>
              <input id="objectName" type="text" placeholder="Item's name">
            </div>
            <div id="creationBasic">
              <input id="objectWeightValue" type="number" placeholder="Weight">
              <input id="objectGoldValue" type="number" placeholder="Gold value">
            </div>
          </div>
          <div id="creationVariable">
            <div id="creationWeapon">
              <select name="weaponType" id="weaponType">
                <option value="Sword">Sword</option>
                <option value="Axe">Axe</option>
                <option value="Hammer">Hammer</option>
                <option value="Shortsword">Shortsword</option>
                <option value="Spear">Spear</option>
                <option value="Staff">Staff</option>
                <option value="Throwing Weapon">Throwing Weapon</option>
                <option value="Bow">Bow</option>
                <option value="Crossbow">Crossbow</option>
              </select>
              <label for="weaponTwoHanded">Two handed</label>
              <input type="checkbox" id="weaponTwoHanded" name="weaponTwoHanded">
              <input id="weaponDamageValue" type="number" placeholder="Weapon Damage Value">
              <select name="weaponLegendaryMod" id="weaponLegendaryMod">
                <option value="ToDeleteWeaponLegendary">Legendary option</option>
              </select>
            </div>
            <div id="creationArmor">
              <select name="armorType" id="armorType">
                <option value="Light">Light</option>
                <option value="Medium">Medium</option>
                <option value="Heavy">Heavy</option>
              </select>
              <input id="armorClassValue" type="number" placeholder="Armor Value">
              <select name="armorLegendaryMod" id="armorLegendaryMod">
                <option value="ToDeleteArmorLegendary">Legendary option</option>
              </select>
            </div>
            <div id="creationPotion">
              <select name="potionType" id="potionType">
                <option value="Poison">Poison</option>
                <option value="Healing">Healing</option>
              </select>
              <input id="potionPowerValue" type="number" placeholder="Potion Power Value">
            </div>
            <div id="creationScroll">
              <select name="scrollType" id="scrollType"> 
              <option  value="placeholdertodelete-SpellList">none</option>
              </select>
            </div>
            <div id="creationMaterial">
              <select name="materialType" id="materialType">
                <option value="materialtypeList">material type</option>
              </select>
            </div>
            <div id="creationFood">
              <select name="foodType" id="foodType">
                <option value="raw">Raw</option>
                <option value="cooked">Cooked</option>
                <option value="homemade">Home made</option>
                <option value="Spoiled">Spoiled</option>
              </select>
            </div>
          </div>
          <button id="objectCreate">Create</button>

          <button id="objectRemove">Remove</button>

          <select name="objectCategorieSelect" id="objectCategorieList"></select>
          <select name="objectArmorSelect" id="objectArmorList"></select>
          <select name="objectFoodSelect" id="objectFoodList"></select>
          <select name="objectPotionSelect" id="objectPotionList"></select>
          <select name="objectMaterialSelect" id="objectMaterialList"></select>
          <select name="objectScrollSelect" id="objectScrollList"></select>
          <select name="objectWeaponSelect" id="objectWeaponList"></select>

        </div>
       </div>

       <script type="module" defer>
        // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
   
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCSOMTnqSp9YMqNThdPZaV2ZaIrq2aqcNs",
      authDomain: "ttrpg-database-experiment.firebaseapp.com",
      databaseURL: "https://ttrpg-database-experiment-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "ttrpg-database-experiment",
      storageBucket: "ttrpg-database-experiment.appspot.com",
      messagingSenderId: "642474909125",
      appId: "1:642474909125:web:10a4da48b7ee295d0cffac",
      measurementId: "G-TW17GPER06"
    };
   
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const analytics = getAnalytics(app);
    const userPseudo = document.querySelector("#userPseudo")
    const userEmail = document.querySelector("#userEmail");
    const userPassword = document.querySelector("#userPassword");
    const authForm = document.querySelector("#authForm")
    const signUpButton = document.querySelector("#signUpButton")
    const signInButton = document.querySelector("#signInButton")
    let user;
   
    const userSignUp = async() => {
      const signUpPseudo = userPseudo.value;
      const signUpEmail = userEmail.value;
      const signUpPassword = userPassword.value;
      createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
      .then((userCredential) => {
        user = userCredential.user;
        const userRef = ref(db, "users/" + user.uid)
        set(userRef,{
          Pseudo: userPseudo.value,
          Email: userEmail.value,
          uID : user.uid,
        })
        alert("Account Created !");
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.log(errorCode + errorMessage)
        
      })
    }
   
    signUpButton.addEventListener('click', userSignUp)
   
    const userSignIn = async() => {
      const signInEmail = userEmail.value;
      const signInPassword = userPassword.value;
      signInWithEmailAndPassword(auth, signInEmail, signInPassword)
      .then((userCredential) => {
        user = userCredential.user;
        creationKitForm.style.display="block"
        loadItems().then(onItemsLoaded)
        alert("You have signed in !")
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.log(errorCode + errorMessage)
      })
    }
   
    signInButton.addEventListener('click', userSignIn)
   
    import {getDatabase, set, get, update, remove, ref, child} from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js"
   
    const db = getDatabase();
   
   
    var objectName = document.querySelector("#objectName")
    var objectType = document.querySelector("#objectType")
    var objectLegendaryMod = document.querySelector("#objectLegendaryMod")
    var objectGoldValue = document.querySelector("#objectGoldValue")
    var objectCreateBtn = document.querySelector("#objectCreate")
    var objectRemoveBtn = document.querySelector("#objectRemove")
    var itemListBtn = document.querySelector("#objectCategorieList")
   
    
    let items = []
    async function loadItems(){
      const snapshot = await get(ref(db, "Items/" + user.uid))
      items = snapshot.val()
      console.log(items)
    }

    function onItemsLoaded(){
      fillCategorieList()
      fillArmorList()
      fillFoodList()
      fillMaterialList()
      fillPotionList()
      fillScrollList()
      fillWeaponList()
    }
   
    function fillCategorieList(){
      const selectElement = document.getElementById('objectCategorieList')
      for(const key in items){
        const item = items[key]
        const nameValue = key
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }
    function fillArmorList(){
      const selectElement = document.getElementById('objectArmorList')
      for(const key in items.Armor){
        const item = items.Armor[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }   

    function fillFoodList(){
      const selectElement = document.getElementById('objectFoodList')
      for(const key in items.Food){
        const item = items.Food[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }  

    function fillMaterialList(){
      const selectElement = document.getElementById('objectMaterialList')
      for(const key in items.Material){
        const item = items.Material[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }   

    function fillPotionList(){
      const selectElement = document.getElementById('objectPotionList')
      for(const key in items.Potion){
        const item = items.Potion[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }  
    function fillScrollList(){
      const selectElement = document.getElementById('objectScrollList')
      for(const key in items.Scroll){
        const item = items.Scroll[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }  
    function fillWeaponList(){
      const selectElement = document.getElementById('objectWeaponList')
      for(const key in items.Weapon){
        const item = items.Weapon[key]
        const nameValue = item.itemName
        const option = document.createElement('option');
        option.value = key;
        option.text = nameValue;
        selectElement.appendChild(option);
      }
    }  
   
    function InsertData() {
      if(objectName.value.length != 0){
        const itemRef = ref(db, "Items/" + user.uid + "/" + objectTypeList.value + "/" + objectName.value)
        
        set(itemRef, {
            Name: objectName.value,
            Type: objectTypeList.value,
            Value: objectGoldValue.value,
        })
        .then(()=> {
            const selectElement = document.getElementById('objectCategorieList')
            const option = document.createElement('option');
            option.value = objectName.value;
            option.text = objectName.value;
            selectElement.appendChild(option);
            alert("Object Created !")
            
            
        })
        .catch((error)=>{
            alert(error)
        })
      }
      else {
        alert("Enter a name of an object")
      }
    }
   
    function RemoveData() {
      if(objectName.value.length != 0){
        remove(ref(db, "Items/" + objectName.value), {
            Name: objectName.value,
            Type: objectTypeList.value,
            Value: objectGoldValue.value,
        })
        .then(()=> {
            alert("Object removed !")
            const selectElement = document.getElementById('objectCategorieList')
            const option = document.createElement('option');
            option.value = objectName.value;
            option.text = objectName.value;
            selectElement.appendChild(option);
        })
        .catch((error)=>{
            alert(error)
        })
      }
      else {
        alert("Enter a name of an object")
      }
    }
    
   
    function toggleList(){
      let objectCategorieList = document.querySelector('#objectCategorieList')
      if(objectCategorieList.value === Armor){
        console.log("Test ici")
        objectArmorList.style.display = "block"
        objectFoodList.style.display = "none"
        objectPotionList.style.display = "none"
        objectMaterialList.style.display = "none"
        objectScrollList.style.display = "none"
        objectWeaponList.style.display = "none"
      }
      else if(objectCategorieList === Food){
        objectArmorList.style.display = "none"
        objectFoodList.style.display = "block"
        objectPotionList.style.display = "none"
        objectMaterialList.style.display = "none"
        objectScrollList.style.display = "none"
        objectWeaponList.style.display = "none"
      }
      else if(objectCategorieList === Potion){
        objectArmorList.style.display = "none"
        objectFoodList.style.display = "none"
        objectPotionList.style.display = "block"
        objectMaterialList.style.display = "none"
        objectScrollList.style.display = "none"
        objectWeaponList.style.display = "none"
      }
      else if(objectCategorieList === Material){
        objectArmorList.style.display = "none"
        objectFoodList.style.display = "none"
        objectPotionList.style.display = "none"
        objectMaterialList.style.display = "block"
        objectScrollList.style.display = "none"
        objectWeaponList.style.display = "none"
      }
      else if(objectCategorieList === Scroll){
        objectArmorList.style.display = "none"
        objectFoodList.style.display = "none"
        objectPotionList.style.display = "none"
        objectMaterialList.style.display = "none"
        objectScrollList.style.display = "block"
        objectWeaponList.style.display = "none"
      }
      else if(objectCategorieList === Weapon){
        objectArmorList.style.display = "none"
        objectFoodList.style.display = "none"
        objectPotionList.style.display = "none"
        objectMaterialList.style.display = "none"
        objectScrollList.style.display = "none"
        objectWeaponList.style.display = "block"
      }

    }

    itemListBtn.addEventListener('click', toggleList)
    objectCreateBtn.addEventListener('click', CreateItem);
    objectRemoveBtn.addEventListener('click', RemoveData)

    class Items {
      constructor(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue){
        this.itemID = itemID
        this.itemName = itemName
        this.itemRarity = itemRarity
        this.itemType = itemType
        this.itemGoldValue = itemGoldValue
        this.itemWeightValue = itemWeightValue
      }
    }

    class Weapon extends Items {
      constructor(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, weaponType, weaponTwoHanded, weaponDamageValue, weaponLegendaryMod,){
        super(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue)
        this.weaponType = weaponType
        this.weaponTwoHanded = weaponTwoHanded
        this.weaponDamageValue = weaponDamageValue
        this.weaponLegendaryMod = weaponLegendaryMod
      }
  
    }

    class Armor extends Items {
      constructor (itemID, itemName,itemRarity, itemType, itemGoldValue, itemWeightValue, armorType, armorClassValue, armorLegendaryMod){
        super(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue)
        this.armorType = armorType
        this.armorClassValue = armorClassValue
        this.armorLegendaryMod = armorLegendaryMod
      }
    }
    class Potion extends Items{
      constructor (itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue, potionType, potionPowerValue){
        super(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue)
        this.potionType = potionType
        this.potionPowerValue = potionPowerValue
      }
    }
    class Scroll extends Items{
      constructor (itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue, scrollType,){
        super(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue)
        this.scrollType = scrollType
      }
    }
    class Material extends Items{
      constructor (itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue, materialType){
        super(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue)
        this.materialType = materialType
      }
    }
    class Food extends Items{
      constructor (itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue, foodType){
        super(itemID, itemName,itemRarity, itemType,itemGoldValue, itemWeightValue)
        this.foodType = foodType
      }
    }

    
    objectArmorList.style.display = "none"
    objectFoodList.style.display = "none"
    objectPotionList.style.display = "none"
    objectMaterialList.style.display = "none"
    objectScrollList.style.display = "none"
    objectWeaponList.style.display = "none"
    creationKitForm.style.display="none"
    creationWeapon.style.display = "none"
    creationArmor.style.display = "none"
    creationPotion.style.display = "none"
    creationScroll.style.display = "none"
    creationMaterial.style.display = "none"
    creationFood.style.display = "none"
    function creationKit(){
      let objectTypeList = document.getElementById("objectTypeList").value
       if (objectTypeList === "Weapon"){
        creationWeapon.style.display = "block"
        creationArmor.style.display = "none"
        creationPotion.style.display = "none"
        creationScroll.style.display = "none"
        creationMaterial.style.display = "none"
        creationFood.style.display = "none"
       }
       else if (objectTypeList === "Armor"){
        creationWeapon.style.display = "none"
        creationArmor.style.display = "block"
        creationPotion.style.display = "none"
        creationScroll.style.display = "none"
        creationMaterial.style.display = "none"
        creationFood.style.display = "none"
      }
      else if (objectTypeList === "Potion"){
        creationWeapon.style.display = "none"
        creationArmor.style.display = "none"
        creationPotion.style.display = "block"
        creationScroll.style.display = "none"
        creationMaterial.style.display = "none"
        creationFood.style.display = "none"
      }
      else if (objectTypeList === "Scroll"){
        creationWeapon.style.display = "none"
        creationArmor.style.display = "none"
        creationPotion.style.display = "none"
        creationScroll.style.display = "block"
        creationMaterial.style.display = "none"
        creationFood.style.display = "none"
      }
      else if (objectTypeList === "Material"){
        creationWeapon.style.display = "none"
        creationArmor.style.display = "none"
        creationPotion.style.display = "none"
        creationScroll.style.display = "none"
        creationMaterial.style.display = "block"
        creationFood.style.display = "none"
      }
      else if (objectTypeList === "Food"){
        creationWeapon.style.display = "none"
        creationArmor.style.display = "none"
        creationPotion.style.display = "none"
        creationScroll.style.display = "none"
        creationMaterial.style.display = "none"
        creationFood.style.display = "block"
      }
    }

    objectTypeList.addEventListener('change', creationKit);

   



    async function CreateItem() {
      if(objectName.value.length != 0){
      let itemID = crypto.randomUUID()
      const itemRef = ref(db, "Items/" + user.uid + "/" + objectTypeList.value + "/" + itemID)
      let itemRarity = document.querySelector("#objectRarityList").value
      let itemName = document.querySelector("#objectName").value
      let itemType = document.querySelector("#objectTypeList").value
      let itemGoldValue = document.querySelector("#objectGoldValue").value
      let itemWeightValue = document.querySelector("#objectWeightValue").value
        if (itemType === "Weapon"){
        let weaponType = document.querySelector("#weaponType").value
        let weaponTwoHanded = document.querySelector("#weaponTwoHanded").value
        let weaponDamageValue = document.querySelector("#weaponDamageValue").value
        let weaponLegendaryMod = document.querySelector("#weaponLegendaryMod").value
        const weapon = new Weapon(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, weaponType, weaponTwoHanded, weaponDamageValue, weaponLegendaryMod)
        set(itemRef, weapon)
      }
        else if (itemType === "Armor"){
        let armorType = document.querySelector("#armorType").value
        let armorClassValue = document.querySelector("#armorClassValue").value
        let armorLegendaryMod = document.querySelector("#armorLegendaryMod").value
        const armor = new Armor(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, armorType, armorClassValue, armorLegendaryMod)
        set(itemRef, armor)
      }
        else if (itemType === "Potion"){
        let potionType = document.querySelector("#potionType").value
        let potionPowerValue = document.querySelector("#potionPowerValue").value
        const potion = new Potion(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, potionType, potionPowerValue)
        set(itemRef, potion)
      }
        else if (itemType === "Scroll"){
        let scrollType = document.querySelector("#scrollType").value
        const scroll = new Scroll(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, scrollType)
        set(itemRef, scroll)
      }
        else if (itemType === "Material"){
        let materialType = document.querySelector("#materialType").value
        const material = new Material(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, materialType)
        set(itemRef, material)
      }
        else if (itemType === "Food"){
        let foodType = document.querySelector("#foodType").value
        const food = new Food(itemID, itemName, itemRarity, itemType, itemGoldValue, itemWeightValue, foodType)
        set(itemRef, food)
      }
    }
    else{
      alert("Enter a name of an object")
    }

      return null
    }
    // Initialize Firebase
   
     </script>
    </main>
  
</body>

</html>